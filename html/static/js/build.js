var Lazyload=function(d){d=d||document.body;var e,c="-src",u=-200,i=function(){var t=Array.prototype.slice.call(d.querySelectorAll("[-src]"));if(t.length)for(var e,i,a,r,o=window.innerWidth||html.clientWidth,n=window.innerHeight||html.clientHeight,l=0,h=t.length;l<h;l++)(a=(i=t[l]).getBoundingClientRect()).top+a.height>u&&n-a.bottom+a.height>u&&a.left+a.width>u&&o-a.right+a.width>u&&(r=i.getAttribute(c))&&("IMG"!=i.tagName&&((e=new Image).setAttribute("lightbox",""),e.setAttribute("data-url",i.getAttribute("data-url")),i.getAttribute("data-group")&&e.setAttribute("data-group",i.getAttribute("data-group")),i.getAttribute("data-width")&&e.setAttribute("data-width",i.getAttribute("data-width")),i.getAttribute("data-height")&&e.setAttribute("data-height",i.getAttribute("data-height")),i.removeAttribute("-src"),i.removeAttribute("data-url"),i.removeAttribute("data-group"),i.removeAttribute("data-width"),i.removeAttribute("data-height"),i.childNodes[0]?i.insertBefore(e,i.childNodes[0]):i.appendChild(e),i=e),i.classList.add("ani"),i.addEventListener("load",function(){var t=this;setTimeout(function(){t.classList.add("loaded")},1)}),i.setAttribute("src",r),i.removeAttribute(c))},a=0,t=function(){if(!e){var t=+new Date-a;30<t?(i(),a=+new Date):(e=1,setTimeout(function(){i(),e=0,a=+new Date},t))}};return t(),addEventListener("scroll",t),addEventListener("resize",t),t},虚拟相机快门的循环播放=function(g,t){var f=-200,m=1800,p=1800,v=document.createElement("canvas");v.style.cssText="width:100%;height:100%;display:block;";var e=document.createElement("div");e.className="content-image pika",e.appendChild(v),t.appendChild(e),e.img=v,e.width=g[0].width,e.height=g[0].height,e.scale=e.height/e.width,e.width<e.height?m=(p=1200)/e.height*e.width:p=(m=1200)/e.width*e.height,v.width=m,v.height=p;var b=v.getContext("2d"),w=g.length;b.globalAlpha=1;var x=+new Date;b.rect(0,0,m,p),b.fillStyle="#000",b.globalAlpha=1,b.fill();var A=function(){if(setTimeout(A,1e3),v.offsetHeight){var t=window.innerWidth||html.clientWidth,e=(window.innerHeight||html.clientHeight,v.getBoundingClientRect());if(e.top+e.height>f&&t-e.bottom+e.height>f&&e.left+e.width>f&&t-e.right+e.width>f){var i=+new Date,a=1e3*w,r=w*((i-x)%a/a),o=Math.floor(r);o<0&&(o=0);var n=g[o%=w];b.rect(0,0,m,p),b.fillStyle="#000",b.fill();var l,h,d,c,u=n.img.naturalWidth,s=n.img.naturalHeight;u/s<m/p?(d=u*p/s,c=p,h=Math.floor((m-d)/2),l=0):(c=s*(d=m)/u,h=0,l=Math.floor((p-c)/2)),n.img.complete&&b.drawImage(n.img,0,0,u,s,h,l,d,c)}}};return setTimeout(A,1e3),e};!function(){var n,l=document.documentElement,t=document.body,h=0,d=0,a=function(i){if(!h){var a;n&&n.img&&n.img.parentNode&&c(n,1),h=1,l.setAttribute("lightbox-loading",1),d=1,l.setAttribute("lightbox-switch",1),i.img?a=i.img:((a=document.createElement("img")).className="lightbox-bigger-img",a.src=i.getAttribute("data-url")||i.src),f=m;var t=function(t,e,i,a){i=i||l.clientWidth,a=a||window.innerHeight||l.clientHeight;var r=e/t;return t<i&&e<a||(i<t&&(e=(t=i)*r),a<e&&(t=(e=a)/r)),{width:t,height:e,top:(a-e)/2,left:(i-t)/2}}(Math.max(+i.getAttribute("data-width"),2*i.naturalWidth),Math.max(+i.getAttribute("data-height"),2*i.naturalHeight)),e=function(t,e){var i=t.getBoundingClientRect(),a=t.ghost||t.cloneNode(1),r=i.width/(e.width-i.width),o=i.top-e.top;trTop=o*r,trTop=trTop/i.height*100;var n=i.left-e.left;trLeft=n*r,trLeft=trLeft/i.width*100;var l=e.width/i.width;return a.removeAttribute("lightbox"),a.className="lightbox-ghost",a.style.cssText="transform-origin:"+trLeft+"% "+trTop+"%;width:"+i.width+"px;height:"+i.height+"px;top:"+i.top+"px;right:"+i.right+"px;bottom:"+i.bottom+"px;left:"+i.left+"px;",g.appendChild(a),setTimeout(function(){a.style.cssText+="transform:scale("+l+");"}),a}(i,t);i.ghost=e,i.img=a;var r=+new Date;a.style.cssText="width:"+t.width+"px;height:"+t.height+"px;";var o=function(){var t=+new Date-r,e=function(){g.appendChild(a),u(i),h=0};l.removeAttribute("lightbox-loading"),300<t?e():setTimeout(e,300-t)};a.complete?o():a.onload=o,i.classList.add("lightbox-hidden"),s.classList.remove("hide"),n=i}},c=function(t,e){h||(g.appendChild(t.ghost),g.removeChild(t.img),setTimeout(function(){t.ghost.style.cssText+="transform:scale(1);"}),e||(s.classList.add("shadowout"),o.innerHTML=""),d=0,setTimeout(function(){g.removeChild(t.ghost),t.classList.remove("lightbox-hidden"),e||(l.removeAttribute("lightbox-switch"),s.classList.add("hide"),s.classList.remove("shadowout"))},300))},u=function(t){var e=t.getAttribute("data-group");if(e){var i=Array.prototype.slice.call(document.querySelectorAll('img[lightbox][data-group="'+e+'"]')),a=i.length;if(a<=1)o.innerHTML="";else{var r=i.indexOf(t);o.innerHTML=r+1+"/"+a}}else o.innerHTML=""},s=document.createElement("div");s.className="lightbox-shadow hide",s.innerHTML='<div class="lightbox-box"></div><h4></h4><i></i>',t.appendChild(s);var g=s.querySelector(".lightbox-box"),o=s.querySelector("i");t.addEventListener("click",function(t){var e=t.target;""===e.getAttribute("lightbox")&&a(e)}),s.onmousemove=function(t){t.target;n.img.style.cssText+="transform-origin:"+t.clientX/l.clientWidth*100+"% "+t.clientY/l.clientHeight*100+"%;"};var f=1,m=1;s.onmousewheel=function(t){t.preventDefault();t.target;n.img.style.cssText+="transform-origin:"+t.clientX/l.clientWidth*100+"% "+t.clientY/l.clientHeight*100+"%;",(f+=t.deltaY/400*(f/5))<m&&(f=m),5<f&&(f=5),n.img.style.cssText+="transform:scale("+f+");"},addEventListener("keyup",function(t){if(d)switch(t.keyCode){case 37:!function(){if(!h&&n){var t=n.getAttribute("data-group");if(t){var e=Array.prototype.slice.call(document.querySelectorAll('img[lightbox][data-group="'+t+'"]'));if(e.length){var i=e.indexOf(n)-1;-1!=i&&a(e[i])}}}}();break;case 39:!function(){if(!h&&n){var t=n.getAttribute("data-group");if(t){var e=Array.prototype.slice.call(document.querySelectorAll('img[lightbox][data-group="'+t+'"]'));if(e.length){var i=e.indexOf(n)+1;i!=e.length&&a(e[i])}}}}()}});var e={};s.ontouchstart=function(t){console.log(t.touches),2==t.touches.length&&(1,e.a=t.touches[0],e.b=t.touches[1])},s.ontouchmove=function(t){t.preventDefault()},s.onclick=function(){n&&c(n)}}(),function(){var t,i=function(t,e){return i=(e||document).querySelectorAll(t),Array.prototype.slice.call(i);var i},e=function(x){if(!x.started){x.started=1,x.style.cssText="height:1000px";var A=+x.getAttribute("data-height"),y=+x.getAttribute("data-width"),T=+x.getAttribute("data-padding"),L=x.offsetWidth-2*T,M=i(".content-image",x);1,x.classList.add("absfix");var a=0;M.forEach(function(t){if(t.getAttribute("data-height"))t.height=+t.getAttribute("data-height"),t.width=+t.getAttribute("data-width");else{var e=(i="img",(t||document).querySelector(i));t.img=e,t.height=+e.getAttribute("data-height"),t.width=+e.getAttribute("data-width")}var i;t.scale=t.height/t.width,a+=1-t.width/t.height});var t=function(t){var i={};t.forEach(function(t){var e=Math.floor(8*t.scale);i[e]||(i[e]=[]),i[e].push(t)});var e=0;for(var a in i)e?i[e].length<i[a].length&&(e=a):e=a;return i[e]}(M);t&&4<t.length&&M.push(虚拟相机快门的循环播放(t,x));var E=0<a?"纵向":"横向",e=function(){if(L=x.offsetWidth-2*T,"横向"==E){for(var t,e=0,i=-1;h=M[++i];)h.expectWidth=A/h.scale,h.left=e,e+=h.expectWidth;t=e/Math.round(e/L);var a=单行宽度=0,r=0,o=[];o[r]={item:[]};for(i=-1;h=M[++i];){if(t*(r+1)<h.left||!M[i+1]){if(!M[i+1]){o[r].item.push(h),o[r].expectWidth=h.left-a+h.expectWidth,a=h.left;break}o[r].expectWidth=h.left-a,a=h.left,o[++r]={item:[]}}o[r].item.push(h)}o[o.length-1].item.length||o.pop();var n=0;for(i=-1;h=o[++i];){var l=L-T*(h.item.length-1);h.h=Math.floor(l/h.expectWidth*A),h.top=n,n+=h.h+T}i=-1;for(var h,d=0,c=0;h=o[++i];)d=0,h.item.forEach(function(t){var e=Math.floor(h.h/t.scale);t.style.cssText+="height:"+h.h+"px;width:"+e+"px;top:"+h.top+"px;left:"+d+"px;",d+=e+T,c=h.top+h.h+T});x.style.cssText+=";height:"+c+"px;"}else{var u=[],s=Math.floor((L+T)/y);s<1&&(s=1);var g=Math.floor((L+T)/s)-T;for(i=0;i<s;i++)u[i]=0;i=0;for(var f,m=M.length;i<m;i++){f=M[i];var p=(w=u).indexOf(Math.min.apply(Math,w)),v=Math.ceil(f.scale*g);f.style.cssText+="width:"+g+"px;height:"+v+"px;top:"+u[p]+"px;left:"+p*(g+T)+"px;",u[p]+=v+T}x.style.cssText+=";height:"+u[(b=u,b.indexOf(Math.max.apply(Math,b)))]+"px;"}var b,w};return e(),{repull:x.repull=e}}x.repull()};e.init=function(){i("[fall]").forEach(e)},addEventListener("resize",function(){clearTimeout(t),t=setTimeout(e.init,30)}),window.Fall=e}(),Fall.init(),function(){var d,c=document,u=function(t,e){return i=(e||c).querySelectorAll(t),Array.prototype.slice.apply(i);var i},s={},r=function(){return location.pathname+location.search},o=Lazyload(document.body),g=function(t){var e,i,a;t.url!=r()&&history.pushState({url:t.url,title:t.title},t.title,t.url),document.title=t.title,(e=M.children[0])&&e.parentNode&&e.parentNode.removeChild(e),i=M,a=t.dom,i.appendChild(a),t.scroll&&setTimeout(function(){scrollTo(0,t.scroll)}),window.萌评&&萌评.运转(),Fall.init(),o(),n()},i=function(o){o!=d&&(s[d]&&(s[d].scroll=c.body.scrollTop||c.documentElement.scrollTop),d=o),u("header nav a.active").forEach(function(t){t.classList.remove("active")});var t=o.match(/\/(\w{0,})/);t=t[1];var e,i,a,r,n,l,h=(e='header nav a[href*="/'+t+'"]',(i||c).querySelector(e));if(h&&h.classList.add("active"),s[o])return g(s[o]);a=o,r=function(t){var e=t.match(/<title>(.+?)<\/title>/);e=e?e[1]:"";var i,a,r=(i=t.replace(/^.+?<div id="?M"?>/,"").replace(/<\/div><scri.+?$/,""),(a=c.createElement("div")).innerHTML=i,a.children[0]);s[o]={url:o,title:e,dom:r},scrollTo(0,0),g(s[o])},n=function(){location.href=o},(l=new XMLHttpRequest).open("GET",a),l.onload=function(){r&&r(l.response)},l.onerror=n,l.send()},e=function(){return u(".panorama-box,.content-image-panorama")},a=function(){if(window.pannellum){var t=e();t.length&&t.forEach(function(t){if(!t.loaded){t.loaded=1;var e={type:"equirectangular",panorama:t.getAttribute("data-src"),dynamic:1,autoLoad:!0,hfov:t.classList.contains("content-image-panorama")?80:120,autoRotate:-.1,mouseZoom:"fullscreenonly"};t.getAttribute("data-text")&&(e.title=t.getAttribute("data-text")),t.getAttribute("data-auto-rotate")&&(e.autoRotate=t.getAttribute("data-auto-rotate")),t.getAttribute("data-un-auto-load")&&(e.autoLoad=!1),t.getAttribute("data-hfov")&&(e.hfov=t.getAttribute("data-hfov")),pannellum.viewer(t,e)}})}},n=function(){if(!window.pannellum&&e().length){var t=document.createElement("script");t.src="/static/js/pannellum.js",t.onload=a,document.body.appendChild(t)}else a()};n();

var t;
t=location.pathname+location.search,
s[t]={url:t,title:document.title,dom:M.children[0]},
c.body.onclick=function(t){for(var e=t.target;e&&"A"!=e.tagName&&e!=this&&(e=e.parentNode););!e||"A"!=e.tagName||"_blank"==e.getAttribute("target")||e.origin!=location.origin||t.ctrlKey||t.metaKey||(i(e.pathname+e.search),t.preventDefault())},
window.addEventListener("popstate",function(){i(r())})
}();